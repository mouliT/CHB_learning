# Vasishta CHB Tutorial — Project Instructions

## Project Identity
- **Student:** Vasishta
- **Paper:** "DC-Link Voltage Balancing Modulation for Cascaded H-Bridge Converters" — Ko, Tcai, Liserre, IEEE Access 2021
- **Document:** `CHB_DC_Link_Voltage_Balancing.tex`
- **Repo:** https://github.com/mouliT/CHB_learning (Overleaf pulls from GitHub for compilation)
- **Workflow:** edit locally → git commit/push → Overleaf pull → compile → student reads → green signal → next section

## Hard Rules
1. **One section at a time.** Write one section, stop, wait for the user's explicit green signal before writing the next. Never pre-populate multiple sections.
2. **Commit and push automatically** after every correction or new section. Do NOT ask for push permission — it is pre-approved for this project.
3. **Pull before editing** if the user says they pushed from Overleaf (`git pull` first).

## Document Structure
- Uses `\setcounter{section}{-1}` so Section 0 exists before Section 1.
- LaTeX macros defined in preamble: `\vg`, `\ig`, `\Vdc`, `\Vdci{i}`, `\Mi`, `\phic`, `\PH`, `\PHi{i}`, `\PHnc`, `\PHcl`, `\Vtot`, `\figref`, `\omg`, `\phig`, `\Ig`
- Figure macro: `\figentry{label}{filename-no-ext}{caption}{width}` (4 args, no .png extension)
- `\graphicspath{{figures/}}` — all PNGs live in `figures/`
- tcolorbox environments: `circuitbox` (blue), `statebox` (orange), `eqnbox` (green), `physbox` (gray), `warningbox` (red)

## Figures
- **Paper figures:** `figures/DLVBMCHBC_Fig[N]_page[XX].png` (N = 1..14)
- **Custom figures:** generated by Python scripts in the project root
  - `gen_staircase_buildup.py` → `CHB_staircase_buildup.png` (fc = 12f, n=3 cell breakdown) — **in document**
  - `gen_staircase.py` → `CHB_staircase_summation.png` (fc = 6f, n=1..4 comparison) — **NOT in document** (TODO comment marks the spot)

## Known Bugs — Do NOT Re-introduce
1. **Unipolar PWM comparator:** must use `np.abs(carrier)`, NOT `carrier`. The old formula `ref > carrier` fired when carrier was negative, causing DC offset and wrong null states.
2. **Figure filenames:** `DLVBMCHBC_Fig*` (NOT `P3_Fig*` — that was a previous naming convention).
3. **Grid voltage equation:** `v_g = v_1 + v_2 + ... + v_n` (NOT `i_g × sum(...)` — that is dimensionally wrong).
4. **Torch battery analogy:** removed by user — do not re-introduce it.

## Document Progress
| Section | Status | Notes |
|---|---|---|
| §0 Before You Begin | ✅ Complete | All 6 subsections, buildup figure embedded |
| §1 The Circuit | ✅ Complete | Paper Fig.1, component walk-through, loading power with governing equations |
| §2+ | ⏳ Not started | Awaiting green signal on §1 |

## §1 Key Equations (for continuity)
- Capacitor energy balance: `C·Vdc,i·dVdc,i/dt = P_i,src - P_H,i`
- Steady-state condition per cycle k: `P_H,i(k) = P_i,src(k)`
- Non-clamped loading power (derived in §2): `P_H,i = ½·Vdc,i·Mi·Ig·cos(φ_g)`
- "Continuously corrects" means re-solving Mi(k) every grid cycle because P_i,src(k) changes

## Next Section Plan (§2)
Cover: how P_H,i = ½·Vdc,i·Mi·Ig·cos(φ_g) is derived (integral of v_i·i_g over one period),
and introduce the control scheme (paper Fig. 2 — typical control architecture).
